<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Swift Parking | Registration Page</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="../plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- icheck bootstrap -->
  <link rel="stylesheet" href="../plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../dist/css/adminlte.min.css">

  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

  <link rel="stylesheet" href="/admin/dist/notiflix-1.3.0.min.css">
  <script src="/admin/dist/jquery-1.11.0.min.js" type="text/javascript"></script>
  <script src="/admin/dist/notiflix-1.3.0.min.js" type="text/javascript"></script>


</head>
<body class="hold-transition register-page">
<div class="register-box">
  <div class="register-logo">
    <a class="loading" href="/welcome/welcome.html"><b>Swift</b> Parking</a>
  </div>

  <div class="card">
    <div class="card-body register-card-body">
      <p class="login-box-msg">Register a new membership</p>

      <form action="/account/register.do" method="post">
        <label for="username"><span style="color: red">*</span>Username</label>
        <div class="input-group mb-3">
          <input id="username" name="username" type="text" class="form-control" placeholder="Username">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fas fa-user"></span>
            </div>
          </div>
        </div>
        <label for="password"><span style="color: red">*</span>Password</label>
        <div class="input-group mb-3">
          <input id="password" name="password" type="password" class="form-control" placeholder="Password">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fas fa-lock"></span>
            </div>
          </div>
        </div>
        <label for="retypepassword"><span style="color: red">*</span>Retype password</label>
        <div class="input-group mb-3">
          <input id="retypepassword"  name="confirm_pass" type="password" class="form-control" placeholder="Retype password">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fas fa-lock"></span>
            </div>
          </div>
        </div>
        <label for="fullname"><span style="color: red">*</span>Full name</label>
        <div class="input-group mb-3">
          <input id="fullname" name="name" type="text" class="form-control" placeholder="Full name">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fas fa-user"></span>
            </div>
          </div>
        </div>
        <label for="email"><span style="color: red">*</span>Email</label>
        <div class="input-group mb-3">
          <input id="email" name="email" type="email" class="form-control" placeholder="Email">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fas fa-envelope"></span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Gender</label>
          <div class="form-check">
            <input class="form-check-input" id="male" type="radio" name="gender" value="male" checked="checked">
            <label class="form-check-label" for="male">Male</label>
            &emsp;&emsp;
            <input class="form-check-input" id="female" type="radio" name="gender" value="female">
            <label class="form-check-label" for="female">Female</label>
          </div>
        </div>

        <div class="form-group">
          <label for="birthday">Birthday</label>
          <div class="input-group mb-3">
            <input id="birthday" name="tempdate" type="text" class="form-control" data-inputmask-alias="datetime" data-inputmask-inputformat="dd/mm/yyyy" data-mask="" im-insert="false">
            <div class="input-group-append">
              <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
            </div>
          </div>
          <!-- /.input group -->
        </div>

        <div class="row">
          <div class="col-8">
            <div class="icheck-primary">
              <input type="checkbox" id="agreeTerms" name="terms" value="agree">
              <label for="agreeTerms">
               I agree to the <a href="#">terms</a>
              </label>
            </div>
          </div>
          <!-- /.col -->
          <div class="col-4">
            <button id="submit" type="submit" class="btn btn-primary btn-block">Register</button>
          </div>
          <!-- /.col -->
        </div>
      </form>
<!--
      <div class="social-auth-links text-center">
        <p>- OR -</p>
        <a href="#" class="btn btn-block btn-primary">
          <i class="fab fa-facebook mr-2"></i>
          Sign up using Facebook
        </a>
        <a href="#" class="btn btn-block btn-danger">
          <i class="fab fa-google-plus mr-2"></i>
          Sign up using Google+
        </a>
      </div>
-->
      <a href="login.html" class="loading text-center">I already have a membership</a>
    </div>
    <!-- /.form-box -->
  </div><!-- /.card -->
</div>
<!-- /.register-box -->

<!-- jQuery -->
<script src="../plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="../dist/js/adminlte.min.js"></script>

<script src="../dist/js/message.js"></script>

<script src="../plugins/inputmask/min/jquery.inputmask.bundle.min.js"></script>




<script>
  $(function(){
    Notiflix.Loading.Init({
      clickToClose:false
    });

    $('.loading').each(function () {
      $(this).click(function(){
        Notiflix.Loading.Standard();
      })
    })

    //Datemask dd/mm/yyyy
    $('#birthday').inputmask('dd/mm/yyyy', { 'placeholder': 'dd/mm/yyyy' });
    var usernamevalid = false;
    var passwordvalid = false;
    var confirm_passvalid = false;
    var fullnamevalid = false;
    var emailvalid = false;


    $("#submit").click(function() {

      if(usernamevalid && passwordvalid && confirm_passvalid && fullnamevalid && emailvalid) {
        $.message({
          message:'Submitting...',
          type:'success'
        });
        Notiflix.Loading.Standard();
      }
      else {
        $.message({
          message:'Register Fail.',
          type:'error'
        });
        return false;
      }
    })

    function createXMLHttpRequest() {
      try {
        return new XMLHttpRequest();
      } catch (e) {
        try {
          return ActvieXObject("Msxml2.XMLHTTP");
        } catch (e) {
          try {
            return ActvieXObject("Microsoft.XMLHTTP");
          } catch (e) {
            alert("Maybe try a better browser");
            throw e;
          }
        }
      }
    }


    var checkInput = {
      username: [
        /^[a-zA-Z0-9_-]{4,20}$/, 'Username must include 4-20 characters.'
      ],
      email: [
        /^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/, 'Wrong email address.'
      ],
      password: function(value) {
        var countNum = 0;
        var letter = /^[a-zA-Z]+$/;
        var num = /[0-9]$/;
        if (value.length < 8 || value.length > 16) {
          return "Password must include 8-16 characters (more than 2 numbers).";
        }
        for (i = 0; i < value.length; i++) {
          if (num.test(value.charAt(i))) {
            countNum++;
          } else if (!letter.test(value.charAt(i))) {
            return "Password must include 8-16 characters (more than 2 numbers).";
          }
        }
        if (countNum < 2) {
          return "Password must include 8-16 characters (more than 2 numbers).";
        }
        return true;
      },
      validateMoney:[
        /(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/,'输入格式有误'
      ]
    }



    var userEle = document.getElementById("username");
    var passEle = document.getElementById("password");
    var confirm_passEle = document.getElementById("retypepassword");
    var fullnameEle = document.getElementById("fullname");
    var emailEle = document.getElementById("email");

    userEle.onblur = function() {

      if(userEle.value == "") {
        usernamevalid = false;
        $(userEle).css({
          "background-color": "#ffaca9"
        });
        $.message({
          message:'Username can not be null.',
          type:'error'
        });
      }
      else if(checkInput['username'][0].test(userEle.value)) {
        var xmlHttp = createXMLHttpRequest();
        xmlHttp.open("POST", "/account/verifyUser.do", true);
        xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xmlHttp.send("receiver=" + userEle.value);

        xmlHttp.onreadystatechange = function() {
          if(xmlHttp.readyState == 4 && xmlHttp.status == 200) {
            var text = xmlHttp.responseText;
            var json= JSON.parse(text);
            if(json.valid == "false") {
              usernamevalid = true;

              $(userEle).css({
                "background-color": "#c3ffb8"
              });
              $.message({
                message:'Right Username!',
                type:'success'
              });

            } else {
              usernamevalid = false;

              $(userEle).css({
                "background-color": "#ffaca9"
              });
              $.message({
                message:'Username already exists!',
                type:'error'
              });
            }
          }
          else if(xmlHttp.status != 200) {
            usernamevalid = false;

            $(userEle).css({
              "background-color": "#ffaca9"
            });
            $.message({
              message:'Server Checkout Fail!',
              type:'error'
            });
          }
        };

      }
      else {
        usernamevalid = false;
        $(userEle).css({
          "background-color": "#ffaca9"
        });
        $.message({
          message: checkInput['username'][1],
          type:'error'
        });
      }

    };

    passEle.onblur = function() {
      var keyFunction = checkInput['password'];
      var passCheck = keyFunction(passEle.value);
      if(passEle.value == "") {
        passwordvalid = false;
        $(passEle).css({
          "background-color": "#ffaca9"
        });
        $.message({
          message:'Password can not be null.',
          type:'error'
        });
      }
      else if(passCheck != true) {
        passwordvalid = false;
        $(passEle).css({
          "background-color": "#ffaca9"
        });
        $.message({
          message: passCheck,
          type:'error'
        });
      }
      else {
        passwordvalid = true;
        $(passEle).css({
          "background-color": "#c3ffb8"
        });
      }
    };

    confirm_passEle.onblur = function() {
     if(passwordvalid && confirm_passEle.value != passEle.value) {
        confirm_passvalid = false;
        $(confirm_passEle).css({
          "background-color": "#ffaca9"
        });
        $.message({
          message:'Retyped password not match.',
          type:'error'
        });
      }
     else if(passwordvalid && confirm_passEle.value == passEle.value) {
       confirm_passvalid = true;
       $(confirm_passEle).css({
         "background-color": "#c3ffb8"
       });
     }
     else {
       confirm_passvalid = false;
       $(confirm_passEle).css({
         "background-color": "#ffaca9"
       });
       $.message({
         message:'Check out the password.',
         type:'error'
       });
     }
    };

    fullnameEle.onblur = function() {
      if(fullnameEle.value == "") {
        fullnamevalid = false;
        $(fullnameEle).css({
          "background-color": "#ffaca9"
        });
        $.message({
          message:'Full Name can not be null.',
          type:'error'
        });
      }
      else {
        fullnamevalid = true;
        $(fullnameEle).css({
          "background-color": "#c3ffb8"
        });
      }
    };

    emailEle.onblur = function() {
      if(emailEle.value == "") {
        emailvalid = false;
        $(emailEle).css({
          "background-color": "#ffaca9"
        });
        $.message({
          message:'Email can not be null.',
          type:'error'
        });
      }
      else if(!checkInput['email'][0].test(emailEle.value)) {
        emailvalid = false;
        $(emailEle).css({
          "background-color": "#ffaca9"
        });
        $.message({
          message: checkInput['email'][1],
          type:'error'
        });
      }
      else {
        emailvalid = true;
        $(emailEle).css({
          "background-color": "#c3ffb8"
        });
      }
    }




  })

</script>

</body>
</html>
